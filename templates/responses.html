<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Analytics - WellBeing Survey</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --joy-color: #f59e0b;
            --achievement-color: #10b981;
            --meaning-color: #8b5cf6;
            --light-bg: #f8fafc;
        }

        body {
            background: linear-gradient(135deg, var(--light-bg) 0%, #e2e8f0 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--meaning-color) 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 1rem 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            text-align: center;
            padding: 1.5rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .metric-label {
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
        }

        .joy-color { color: var(--joy-color); }
        .achievement-color { color: var(--achievement-color); }
        .meaning-color { color: var(--meaning-color); }

        .response-badge {
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
        }

        .table th {
            border-top: none;
            font-weight: 600;
            color: #374151;
            background-color: #f9fafb;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2"><i class="fas fa-chart-line me-3"></i>Survey Analytics</h1>
                    <p class="mb-0 opacity-90">Insights from daily wellbeing responses</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/admin" class="btn btn-light">
                        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container"

        {% if responses %}
            <!-- Summary Statistics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="metric-label">Total Responses</div>
                        <div class="metric-value text-primary">{{ responses|length }}</div>
                        <i class="fas fa-comments fa-2x text-primary opacity-25"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="metric-label">Average Joy</div>
                        {% set joy_sum = responses | sum(attribute=2) %}
                        {% set joy_avg = (joy_sum / responses|length) | round(1) %}
                        <div class="metric-value joy-color">{{ joy_avg }}</div>
                        <i class="fas fa-smile fa-2x joy-color opacity-25"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="metric-label">Average Achievement</div>
                        {% set achievement_sum = responses | sum(attribute=3) %}
                        {% set achievement_avg = (achievement_sum / responses|length) | round(1) %}
                        <div class="metric-value achievement-color">{{ achievement_avg }}</div>
                        <i class="fas fa-trophy fa-2x achievement-color opacity-25"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="metric-label">Average Meaning</div>
                        {% set meaning_sum = responses | sum(attribute=4) %}
                        {% set meaning_avg = (meaning_sum / responses|length) | round(1) %}
                        <div class="metric-value meaning-color">{{ meaning_avg }}</div>
                        <i class="fas fa-heart fa-2x meaning-color opacity-25"></i>
                    </div>
                </div>
            </div>

            <!-- Responses Table -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-table me-2"></i>Individual Responses</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-calendar me-1"></i>Date</th>
                                            <th><i class="fas fa-phone me-1"></i>User</th>
                                            <th><i class="fas fa-smile me-1"></i>Joy</th>
                                            <th><i class="fas fa-trophy me-1"></i>Achievement</th>
                                            <th><i class="fas fa-heart me-1"></i>Meaning</th>
                                            <th><i class="fas fa-comment me-1"></i>Influence</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for response in responses %}
                                        <tr>
                                            <td>
                                                <small class="text-muted">{{ response[6] }}</small>
                                            </td>
                                            <td>
                                                <span class="font-monospace">{{ response[1] }}</span>
                                            </td>
                                            <td>
                                                <span class="badge response-badge" style="background-color: var(--joy-color);">
                                                    {{ response[2] }}/10
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge response-badge" style="background-color: var(--achievement-color);">
                                                    {{ response[3] }}/10
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge response-badge" style="background-color: var(--meaning-color);">
                                                    {{ response[4] }}/10
                                                </span>
                                            </td>
                                            <td>
                                                <small class="text-muted">{{ response[5] or 'No comment' }}</small>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                {% else %}
                    <div class="alert alert-info">
                        <h4>ðŸ“­ No Responses Yet</h4>
                        <p>No survey responses have been collected yet. Send a test SMS and reply to it to see responses here!</p>
                        <p><strong>Expected response format:</strong> "8 7 9 Had a great day at work"</p>
                        <ul>
                            <li>First number: Joy rating (1-10)</li>
                            <li>Second number: Achievement rating (1-10)</li>
                            <li>Third number: Meaning rating (1-10)</li>
                            <li>Text after numbers: What influenced your ratings</li>
                        </ul>
                    </div>
                {% endif %}

                <div class="mt-4">
                    <h3>ðŸ”§ Testing Instructions</h3>
                    <div class="alert alert-warning">
                        <p><strong>To test response collection:</strong></p>
                        <ol>
                            <li>Send a test SMS from the admin panel</li>
                            <li>Reply to the SMS with format: <code>8 7 9 Had a productive day</code></li>
                            <li>Refresh this page to see the response</li>
                        </ol>
                        <p><strong>Note:</strong> Webhook URL needs to be publicly accessible for TextBelt to send replies.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
